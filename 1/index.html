<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prokudin-Gorskii: Automatic Color Reconstruction — Project Report</title>
  <style>
    :root{--accent:#1f6feb;--muted:#6b7280;--card:#f8fafc}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;line-height:1.5;color:#0f172a;margin:0;background:#ffffff}
    .container{max-width:980px;margin:36px auto;padding:28px}
    header{display:flex;align-items:center;gap:18px}
    h1{margin:0;font-size:28px}
    .meta{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:20px;margin-top:22px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(10,20,40,0.04)}
    section{margin-bottom:18px}
    h2{font-size:18px;margin:0 0 10px}
    p{margin:0 0 10px}
    code{background:#eef2ff;padding:2px 6px;border-radius:6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace}
    .kv{display:flex;gap:8px;flex-wrap:wrap}
    .kv-item{background:#fff;border:1px solid #e6eef8;padding:8px 10px;border-radius:8px;font-size:13px}
    .results img{max-width:100%;border-radius:8px;border:1px solid #e6eef8}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px;border-bottom:1px solid #eef2f7;text-align:left}
    .muted{color:var(--muted)}
    .small{font-size:13px}
    footer{margin-top:28px;color:var(--muted);font-size:13px}
    .btn{display:inline-block;padding:8px 12px;background:var(--accent);color:white;border-radius:8px;text-decoration:none}
    @media (max-width:880px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Prokudin-Gorskii: Automatic Color Reconstruction</h1>
        <div class="meta">Course project — CS180 / CS280A &middot; Your Name: <strong>Joshua Sun</strong></div>
      </div>
    </header>

    <div class="grid">
      <main>
        <section class="card">
          <h2>Overview</h2>
          <p>This project automatically converts Prokudin-Gorskii glass-plate scans (three stacked monochrome channels: B, G, R) into aligned color images. The pipeline implemented for the submission includes:</p>
          <ul>
            <li>channel extraction (split into three equal horizontal bands)</li>
            <li>coarse-to-fine alignment using an image pyramid (translation-only model)</li>
            <li>matching metric: normalized cross-correlation on gradients (robust to brightness differences)</li>
            <li>post-processing: automatic cropping + contrast stretching and optional white-balance</li>
          </ul>
        </section>

        <section class="card">
          <h2>Approach (Technical)</h2>
          <p class="small muted">A concise description of what I implemented — suitable to include in the PDF.</p>
          <ol>
            <li><strong>Preprocessing:</strong> Convert input to floating point (0..1). Divide image into three equal horizontal slices (top=B, middle=G, bottom=R).</li>
            <li><strong>Metric:</strong> Compute gradients (Sobel) and use Normalized Cross-Correlation (NCC) between gradient images to be robust to channel intensity differences.</li>
            <li><strong>Alignment:</strong> Exhaustive search inside ±15 pixels at the coarsest scale. Built a Gaussian pyramid (downscale by 2 each level) and refine offsets from coarse → fine at each level, searching ±2 pixels around the upscaled estimate.</li>
            <li><strong>Crop & Contrast:</strong> Automatic border crop: compute disagreement (sum of absolute differences) across channels and find largest interior rectangle where disagreement is below a threshold. Then perform per-channel contrast stretch (0.5%–99.5% percentile mapping).</li>
          </ol>
          <p>I implemented everything from scratch in <code>main.py</code> using <code>numpy</code> and <code>scipy</code> (only for Sobel). The grader can run <code>python main.py &lt;input_image&gt; &lt;output_prefix&gt;</code>.</p>
        </section>

        <section class="card results">
          <h2>Results (examples)</h2>
          <p class="small muted">Replace the sample images below with your output JPGs before printing to PDF.</p>

          <h3 class="small">monastery.jpg</h3>
          <img src="images/monastery_out.jpg" alt="monastery result" />
          <table>
            <thead>
              <tr><th>Channel aligned to</th><th>Displacement (x, y)</th><th>Notes</th></tr>
            </thead>
            <tbody>
              <tr><td>G → B</td><td>(+3, -2)</td><td class="muted">example; replace with your computed offset</td></tr>
              <tr><td>R → B</td><td>(-1, +4)</td><td class="muted">example</td></tr>
            </tbody>
          </table>

          <h3 class="small" style="margin-top:12px">cathedral.jpg</h3>
          <img src="images/cathedral_out.jpg" alt="cathedral result" />
          <table>
            <thead>
              <tr><th>Channel aligned to</th><th>Displacement (x, y)</th><th>Notes</th></tr>
            </thead>
            <tbody>
              <tr><td>G → B</td><td>(+2, 0)</td><td class="muted">example</td></tr>
              <tr><td>R → B</td><td>(0, +1)</td><td class="muted">example</td></tr>
            </tbody>
          </table>

          <p class="small muted">Tip: use lossless JPG or PNG for the outputs in the web page; the grader asked not to upload large TIFFs to the web page.</p>
        </section>

        <section class="card">
          <h2>Bells &amp; Whistles</h2>
          <ul>
            <li><strong>Automatic cropping:</strong> border detection via channel-disagreement mask + largest interior rectangle.</li>
            <li><strong>Contrast &amp; white-balance:</strong> percentile-based contrast stretch plus simple gray-world white-balance option.</li>
            <li><strong>Alternative features:</strong> alignment on gradients (Sobel) to be invariant to exposure/brightness differences.</li>
            <li><strong>Optional:</strong> small rotation refinement (±1.5°) using a local search at full scale (disabled by default for speed).</li>
          </ul>
        </section>

        <section class="card">
          <h2>Failures & Known Issues</h2>
          <ul>
            <li>Images with extremely low texture or strong periodic patterns can produce local NCC maxima — mitigated with center-crop matching and pyramid refinement.</li>
            <li>Large non-rigid distortions (warping) are not handled; only translation (and optional tiny rotation) are supported.</li>
            <li>Automatic crop may occasionally remove small legitimate margins in rare cases; adjust thresholding parameters in <code>main.py</code>.</li>
          </ul>
        </section>

        <section class="card">
          <h2>How to run (grader)</h2>
          <ol>
            <li>Unzip <code>submission.zip</code> so that <code>code/</code> and <code>web/</code> are at the root.</li>
            <li>Install dependencies: <code>pip install -r code/requirements.txt</code> (requirements contain numpy, scipy, pillow).</li>
            <li>Run: <code>python code/main.py data/monastery.jpg outputs/monastery</code>. The script writes aligned JPGs to <code>outputs/</code> and prints offsets to stdout.</li>
            <li>Print this webpage to PDF (include URL in header/footer) and upload <code>web/page.pdf</code> to Gradescope.</li>
          </ol>
        </section>

      </main>

      <aside>
        <div class="card">
          <h2>Submission ZIP structure</h2>
          <div class="kv" style="margin-top:8px">
            <div class="kv-item"><code>submission.zip</code></div>
            <div class="kv-item"><code>code/</code></div>
            <div class="kv-item"><code>web/page.pdf</code></div>
            <div class="kv-item small muted">Do not include large TIFFs in the web folder.</div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h2>Files to replace</h2>
          <p class="small muted">Update the following images with your results before printing:</p>
          <ul class="small">
            <li><code>web/images/monastery_out.jpg</code></li>
            <li><code>web/images/cathedral_out.jpg</code></li>
            <li>Any additional examples you used (put them in <code>web/images/</code>).</li>
          </ul>
          <a class="btn" href="#print">Print to PDF</a>
        </div>

        <div class="card" style="margin-top:14px">
          <h2>Contact</h2>
          <p class="small">Your Name: <strong>Joshua Sun</strong><br/>Email: <em>you@example.edu</em></p>
        </div>
      </aside>
    </div>

    <footer>
      <p class="small muted">Notes: Before printing to PDF, make sure all placeholder images are replaced and the displacement tables are updated with the actual numeric offsets your program printed. When saving the PDF, enable header/footer printing to include the page URL as required by the assignment.</p>
    </footer>
  </div>
</body>
</html>
